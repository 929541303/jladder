package org.hum.nettyproxy.test.https_client.tls;

import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import org.hum.nettyproxy.test.https_client.tls.domain.TLSRecordProtocol;
import org.hum.nettyproxy.test.https_client.tls.enumtype.TLS_ContentTypeEnum;

public class Parser {
    
    private static Map<Character, Integer> HEX_MAP = new HashMap<>();
    static {
    	HEX_MAP.put('0', 0);
    	HEX_MAP.put('1', 1);
    	HEX_MAP.put('2', 2);
    	HEX_MAP.put('3', 3);
    	HEX_MAP.put('4', 4);
    	HEX_MAP.put('5', 5);
    	HEX_MAP.put('6', 6);
    	HEX_MAP.put('7', 7);
    	HEX_MAP.put('8', 8);
    	HEX_MAP.put('9', 9);
    	HEX_MAP.put('a', 10);
    	HEX_MAP.put('b', 11);
    	HEX_MAP.put('c', 12);
    	HEX_MAP.put('d', 13);
    	HEX_MAP.put('e', 14);
    	HEX_MAP.put('f', 15);
    }


	public static TLSRecordProtocol toTLSRecordProtocol(String s) {
		TLSRecordProtocol protocol = new TLSRecordProtocol();
		protocol.setContentType(TLS_ContentTypeEnum.getEnum(hex2Number(s.substring(0, 2))).getCode());
		protocol.setMajorVersion((byte) hex2Number(s.substring(2, 4)));
		protocol.setMinorVersion((byte) hex2Number(s.substring(4, 6)));
		protocol.setLength((short) hex2Number(s.substring(6, 10)));
		for (int i = 0; i < s.length(); i += 2) {
			int num = HEX_MAP.get(s.charAt(i)) * 16 + HEX_MAP.get(s.charAt(i + 1)) ;
		}
		return protocol;
	}
	
	private static int hex2Number(String hex) {
		int num = 0;
		int pow = 1;
		for (int i = hex.length() - 1; i >= 0 ; i --) {
			num += HEX_MAP.get(hex.charAt(i)) * pow;
			pow *= 16;
		}
		return num;
	}
	
	public static byte[] hex2Bytes(String hex) {
		byte[] bytes = new byte[hex.length() / 2];
		int cur = 0;
		for (int i = 0; i < hex.length() ; i += 2) {
			bytes[cur ++] = (byte)((HEX_MAP.get(hex.charAt(i)) * 16) + HEX_MAP.get(hex.charAt(i + 1)));
		}
		return bytes;
	}
	
	public static void main(String[] args) {
//		String s = "1603010264010002600303d72becbade4d2681a30391d4604978f8578eb6060a1817a49640f1e2e2d44e8720c2292743202588b940e61081368edee434519441adc81cd259f7efc13f766a6300225a5a130113021303c02bc02fc02cc030cca9cca8c013c014009c009d002f0035000a010001f52a2a0000000000160014000011647373302e62647374617469632e636f6d00170000ff01000100000a000a0008aaaa001d00170018000b00020100002300000010000e000c02683208687474702f312e31000500050100000000000d00140012040308040401050308050501080606010201001200000033002b0029aaaa000100001d0020646fd5d5ec56e5d920a54ab813261130dc5f3901f4510de3fd27ccc43a0a2d2b002d00020101002b000b0a7a7a0304030303020301001b00030200025a5a0001000029012b00f600f02edfda67ad65f1301bd318a3cf1fc6d7c7c1bf69d6364313e25f04ea4ad1a8145354423222fbacda1fd120de41f9710d1eacf4575bac72863fa1d436a369328daae9b559cb32f893909e130bc2e59c834f9a1e03a0693b46fc51e82ee517449d77ed8f5e7e78ebc29fb08fc496de1947a5744ad10012112784839fc789482bfb7e71ec57c0ad39391d90cd8b58fff92877780edb03e66a3b85083ccdcc4c32745bd793bf48eeae9eb0a3b6a7daeb0c30ddb3aeaae55722d87756521b023249e32e8bd97d97294c4cbc7df5edb37082309d2784ccb48e43c02ac9d13d12744ccfec9b2b22911c8a864e9892999cdaf6ed9b73472d003130a5432433717226c4fb685b5e9a58a13f6c460a81b57599c4ab4737a16ee98d69c54040cb35b76f29103c26429fcb44d4";
//		System.out.println(s.substring(6,10));
//		System.out.println(hex2Number(s.substring(6,10)));
		
		String hex = "020000004500056400004000400600007f0000017f000001cb27de89029d879f0235e4f8801818e0035900000101080a93c4149f93c41499160303052b0200005103035e9a9d374c55ac2354b35d81dc986f502e17cdd6610d782272196a6eb76480e3205e9a9d371c8238094febb2fe87d84634d5f61db561dbc21d7d67ed6a6dea6861c02f000009ff01000100001700000b00038100037e00037b308203773082025fa00302010202042f5a0c95300d06092a864886f70d01010b0500306c3110300e06035504061307556e6b6e6f776e3110300e06035504081307556e6b6e6f776e3110300e06035504071307556e6b6e6f776e3110300e060355040a1307556e6b6e6f776e3110300e060355040b1307556e6b6e6f776e3110300e06035504031307556e6b6e6f776e301e170d3230303431333133313233375a170d3330303431313133313233375a306c3110300e06035504061307556e6b6e6f776e3110300e06035504081307556e6b6e6f776e3110300e06035504071307556e6b6e6f776e3110300e060355040a1307556e6b6e6f776e3110300e060355040b1307556e6b6e6f776e3110300e06035504031307556e6b6e6f776e30820122300d06092a864886f70d01010105000382010f003082010a0282010100bc0e04403b6dba7e746a377b9d2446d89eee583a2799bea77c6d5668747e76167ade5213e33288a9720ccf7b1cc994cebedd20b18a1f6aa58aea95cd863426e7b78f491bd116c2ab16f4a1a6dad0137bd3b0305f3315044f6cfc604176c65b9141feb4bf0fec26d927cb5e348957314ace9de4e458c43fd03f45e80d91806f612ee1dae730d856b6f70e3e63f9028a62d48cb3a68fce1cc576f260b3cbd7abeaa1ced69f0f7a5517057250f29f81ed9677e96edfa0e2a96d6b1fc19ea1103c8024bc091fe6ddf449bb44c0e9b58bbdb37a47e455079d662b99ca306d67ad4c8c777a3f668a724b0933fdbcbad820a0fbd7ef1c2904f07b3831c28b1bfc4ac5cb0203010001a321301f301d0603551d0e0416041407d62c70ddc80eeb3a88d4720d94da6ccadab059300d06092a864886f70d01010b05000382010100aa12eea3719228f47142fc44952e27383489c18f2773e0e0908ff06c7c243a4e686af8736388f54cd9a9683b5eb78f0589ec42c0b8390a6d501245a854fd593f1d11b28b32129c06f6d93cf67e6f361ed49cd5971eb86e119064712872e628ec5dcb770eda689e49aab2d9eeda35986cca3d00b76ce3316f3328b31f78d6ac85f664d3c4500fd9b63f9fee61629927ab30083734529bc158ac8283d692bd53f523c9425d63bf13664f217d058f70ec87324f6cddd0b78f24f2076095f3d41f4ef7dbc3ddff997d0aed71fba093037edbadc00d8a8a44e813116d3971c03a6159ad3189dfaa20dd440a34d2ef246d8cfec0c4d703567ecad1997a09532a18fc7e0c00014903001741048684e402eb4f874f09f4caffd1b728bfa407b598414425d906d34c960a5b735a5fa70dca289e9d1b4a4ad7c0ac7d5ec4a98490218e02e0e38bdb71088c9d3d7904010100a17cb777f92f2d69f754b7813843580fdb0a541bd7c1b9f1fcf3396a7debc5d7c39894fd080dfd1a55bcb42ab1c76199ba06ab28bec84b60e04803ca2c249e61e32cd1702d6c6abc79c283fd95201d76a9203abc0964640ae77a5dd24b28353ec264d4f7b074233c6f3008ef86d8466ce045140eb29d3e5e15e3c1820ce94d151f14f2f7804f69d2151efe76193b4402d54ec1343c976a997ea3e25c9abd83d4a1e9f0d46d5554c19ba9c0d47f13f3385d8bb0682bbf283f673e097b8d50cf9c4f95ce5e808137668f35d5550c43a50ff369d223eee3be897b2a510b5afe03e5f28c4098b69dbcaa818a66ab835c1722ca9421cf928a0bb377e22e4a76c19cd00e000000";
//			  hex += "1603030e2d0b000e29000e260009b3308209af30820897a003020102020c2cee193c188278ea3e437573300d06092a864886f70d01010b05003066310b300906035504061302424531193017060355040a1310476c6f62616c5369676e206e762d7361313c303a06035504031333476c6f62616c5369676e204f7267616e697a6174696f6e2056616c69646174696f6e204341202d20534841323536202d204732301e170d3139303530393031323230325a170d3230303632353035333130325a3081a7310b300906035504061302434e3110300e060355040813076265696a696e673110300e060355040713076265696a696e6731253023060355040b131c73657276696365206f7065726174696f6e206465706172746d656e7431393037060355040a13304265696a696e67204261696475204e6574636f6d20536369656e636520546563686e6f6c6f677920436f2e2c204c7464311230100603550403130962616964752e636f6d30820122300d06092a864886f70d01010105000382010f003082010a0282010100b4c6bfda53200fea40f3b85217663b36018d12b4990dd39b6c1853b11908b0fa73473e0d3a796278612e543c497c56dac0be6155d542706a10bef5bd8d6496210093630987b719ba0e203e49c853ed028f4601eba1079373bbedf1b3c9e2fbddf0392a83adf44198bc86eaba74a8a6e3d0e5c58eb30bb2d2ac91740eff80102336626508b487f5570c25c700d8f5a85db83341a72a5fdbfa709e21bbae4216660769fe1c262a810fab73e3d65220a46da86cd46648a46ff2680ac565a14ebf047a40431cd375fb75ac19d64a35056ecfd565d144ca6b0c5804c4854f1fbe2c32d1f1c628fbf92636b56dfacb96a2a0d0bcf851df0744bd8f6f67c0d4afd9cdc30203010001a382061930820615300e0603551d0f0101ff0404030205a03081a006082b06010505070101048193308190304d06082b060105050730028641687474703a2f2f7365637572652e676c6f62616c7369676e2e636f6d2f6361636572742f67736f7267616e697a6174696f6e76616c73686132673272312e637274303f06082b060105050730018633687474703a2f2f6f637370322e676c6f62616c7369676e2e636f6d2f67736f7267616e697a6174696f6e76616c73686132673230560603551d20044f304d304106092b06010401a03201143034303206082b06010505070201162668747470733a2f2f7777772e676c6f62616c7369676e2e636f6d2f7265706f7369746f72792f3008060667810c01020230090603551d130402300030490603551d1f04423040303ea03ca03a8638687474703a2f2f63726c2e676c6f62616c7369676e2e636f6d2f67732f67736f7267616e697a6174696f6e76616c7368613267322e63726c308203490603551d11048203403082033c820962616964752e636f6d8212636c69636b2e686d2e62616964752e636f6d8210636d2e706f732e62616964752e636f6d82106c6f672e686d2e62616964752e636f6d82147570646174652e70616e2e62616964752e636f6d8210776e2e706f732e62616964752e636f6d82082a2e39312e636f6d820b2a2e6169706167652e636e820c2a2e6169706167652e636f6d820d2a2e61706f6c6c6f2e6175746f820b2a2e62616964752e636f6d820e2a2e62616964756263652e636f6d82122a2e6261696475636f6e74656e742e636f6d820e2a2e62616964757063732e636f6d82112a2e62616964757374617469632e636f6d820c2a2e6261696661652e636f6d820e2a2e626169667562616f2e636f6d820f2a2e6263652e62616964752e636f6d820d2a2e626365686f73742e636f6d820b2a2e6264696d672e636f6d820e2a2e62647374617469632e636f6d820d2a2e6264746a7263762e636f6d82112a2e626a2e62616964756263652e636f6d820d2a2e636875616e6b652e636f6d820b2a2e646c6e656c2e636f6d820b2a2e646c6e656c2e6f726782122a2e647565726f732e62616964752e636f6d82102a2e6579756e2e62616964752e636f6d82112a2e66616e79692e62616964752e636f6d82112a2e677a2e62616964756263652e636f6d82122a2e68616f3132332e62616964752e636f6d820c2a2e68616f3132332e636f6d820c2a2e68616f3232322e636f6d820e2a2e696d2e62616964752e636f6d820f2a2e6d61702e62616964752e636f6d820f2a2e6d62642e62616964752e636f6d820c2a2e6d697063646e2e636f6d82102a2e6e6577732e62616964752e636f6d820b2a2e6e756f6d692e636f6d82102a2e736166652e62616964752e636f6d820e2a2e736d617274617070732e636e82112a2e73736c322e6475617070732e636f6d820e2a2e73752e62616964752e636f6d820d2a2e7472757374676f2e636f6d82122a2e7875657368752e62616964752e636f6d820b61706f6c6c6f2e6175746f820a6261696661652e636f6d820c626169667562616f2e636f6d820664777a2e636e820f6d63742e792e6e756f6d692e636f6d820c7777772e62616964752e636e82107777772e62616964752e636f6d2e636e301d0603551d250416301406082b0601050507030106082b06010505070302301d0603551d0e0416041476b5e6d649f8f836ea75a96d5e4d555b375cfdc7301f0603551d2304183016801496de61f1bd1c1629531cc0cc7d3b830040e61a7c30820104060a2b06010401d6790204020481f50481f200f0007600bbd9dfbc1f8a71b593942397aa927b473857950aab52e81a909664368e1ed1850000016a9a2ee19a000004030047304502202c7b4dc0f985478a2d0ac0793bd6b4b566f8aafb8258ad2336fe16bca6839921022100c02fcd9c9920cb7d915fd28bc6131073b5c1540333419fa66ac51493cf692b6b0076006f5376ac31f03119d89900a45115ff77151c11d902c10029068db2089a37d9130000016a9a2ede4f000004030047304502200332689e39d0eb5f1961dba712696f28448102a53cc2a313d57e98265f201aa0022100a78b62b3b0b44432e211ff458d55112c36ab299344c8345cce7c355731aeab12300d06092a864886f70d01010b05000382010100aab9cd528edc365d47d48bf3321706468360a327054929b11b466e38fe93fe09436cd2a158241242b7ab41f8470a7d64b575dc5a4514b2a4186b9cb73b8fb37ed2bdc0724b3505ae0d2d191f5073725adf97183bdb2af3de44ce642dc11e84cc76243e30672326e84ff70bf6ec69d77f51a9a06fb8c414e2c04a4ac4005d576ac941c4252b3218aa62a81e4981731c815f5efae49432c3506d8eaacc6c4c530cfa8f4e34799fa560c0f85075b8a19d01e6ab25230c3b2402405824ff34028b946110682fb680e3d05f4a0aa702d2c0983e1de802c8277126b2a887b6db9d10474bc2136234c6d03c390939258ffea2f4f3fbdf9b273dfcd028e86ddcdd17d31f00046d3082046930820351a003020102020b040000000001444ef04247300d06092a864886f70d01010b05003057310b300906035504061302424531193017060355040a1310476c6f62616c5369676e206e762d73613110300e060355040b1307526f6f74204341311b301906035504031312476c6f62616c5369676e20526f6f74204341301e170d3134303232303130303030305a170d3234303232303130303030305a3066310b300906035504061302424531193017060355040a1310476c6f62616c5369676e206e762d7361313c303a06035504031333476c6f62616c5369676e204f7267616e697a6174696f6e2056616c69646174696f6e204341202d20534841323536202d20473230820122300d06092a864886f70d01010105000382010f003082010a0282010100c70e6c3f23937fcc70a59d20c30e533f7ec04ec29849ca47d523ef03348574c8a3022e465c0b7dc9889d4f8bf0f89c6c8c5535dbbff2b3eafbe356e74a46d91322ca36d59bc1a8e3964393f20cbce6f9e6e899c86348787f5736691a191d5ad1d47dc29cd47fe18012ae7aea88ea57d8ca0a0a3a1249a262197a0d24f737ebb473927b05239b12b5ceeb29dfa41402b901a5d4a69c436488def87efee3f51ee5fedca3a8e46631d94c25e918b9895909aee99d1c6d370f4a1e352028e2afd4218b01c445ad6e2b63ab926b610a4d20ed73ba7ccefe16b5db9f80f0d68b6cd908794a4f7865da92bcbe35f9b3c4f927804eff9652e60220e10773e95d2bbdb2f10203010001a382012530820121300e0603551d0f0101ff04040302010630120603551d130101ff040830060101ff020100301d0603551d0e0416041496de61f1bd1c1629531cc0cc7d3b830040e61a7c30470603551d200440303e303c0604551d20003034303206082b06010505070201162668747470733a2f2f7777772e676c6f62616c7369676e2e636f6d2f7265706f7369746f72792f30330603551d1f042c302a3028a026a0248622687474703a2f2f63726c2e676c6f62616c7369676e2e6e65742f726f6f742e63726c303d06082b060105050701010431302f302d06082b060105050730018621687474703a2f2f6f6373702e676c6f62616c7369676e2e636f6d2f726f6f747231301f0603551d23041830168014607b661a450d97ca89502f7d04cd34a8fffcfd4b300d06092a864886f70d01010b05000382010100462aee5ebdae0160373111867174b64649c81016fe2f622317ab1f87f882edcadf0e2cdf64758ee51872a78c3a8bc9aca57750f7ef9ea4e0a08f1457a32a5fec7e6d10e6ba8db00887760e4cb2d951bb1102f25cdd1cbdf355960fd406c0fce2238a2470d3bbf0791aa76170838aaf06c520d8a163d06cae4f32d7ae7c184575052977df4240646486be2a7609316f1d24f499d085fef22108f9c6f6f1d059edd6563c08280367baf0f9f1901647ae67e6bc8048e9427634975569240e83d6a02db4f5f3798a4928741a41a1c2d324883530609417b4e10422313d3b2f1706b2b89d862b5a69ef83f54bc4aab42af87ca1b185948cf40c870cf4ac40f8594998";
		System.out.println(hex.length());
		System.out.println(Arrays.toString(hex2Bytes(hex)));
	}
}
